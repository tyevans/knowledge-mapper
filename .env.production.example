# Knowledge Mapper - Production Environment Configuration
#
# Copy this file to .env.production and fill in actual values.
# NEVER commit .env.production to version control.
#
# For Kubernetes deployments, use ConfigMaps and Secrets instead.
# See docs/operations/environment-configuration.md for details.

# =============================================================================
# ENVIRONMENT
# =============================================================================

# Environment identifier (development, staging, production)
ENV=production

# Disable debug mode in production
DEBUG=false

# Production logging level (info recommended)
LOG_LEVEL=info

# Disable hot reload in production
RELOAD=false

# =============================================================================
# DATABASE (REQUIRED - SECRETS)
# =============================================================================

# PostgreSQL connection string for application runtime
# Format: postgresql+asyncpg://user:password@host:port/database
# Uses app_user with RLS policies enforced (NO BYPASSRLS)
DATABASE_URL=postgresql+asyncpg://knowledge_mapper_app_user:CHANGE_ME@db-host:5432/knowledge_mapper_db

# PostgreSQL connection string for migrations
# Format: postgresql+asyncpg://user:password@host:port/database
# Uses migration_user with BYPASSRLS for schema changes
MIGRATION_DATABASE_URL=postgresql+asyncpg://knowledge_mapper_migration_user:CHANGE_ME@db-host:5432/knowledge_mapper_db

# =============================================================================
# REDIS (REQUIRED - SECRETS)
# =============================================================================

# Redis connection string for caching, sessions, and rate limiting
# Format: redis://default:password@host:port/database
REDIS_URL=redis://default:CHANGE_ME@redis-host:6379/0

# =============================================================================
# OAUTH / AUTHENTICATION (REQUIRED)
# =============================================================================

# OAuth2/OIDC issuer URL (Keycloak realm URL)
# Must be accessible from the backend service
OAUTH_ISSUER_URL=https://auth.example.com/realms/knowledge-mapper-dev

# OAuth client ID for backend token validation
OAUTH_CLIENT_ID=knowledge-mapper-backend

# OAuth audience claim validation
OAUTH_AUDIENCE=knowledge-mapper-backend

# OAuth client secret (for confidential client flows)
# OAUTH_CLIENT_SECRET=CHANGE_ME

# =============================================================================
# API CONFIGURATION
# =============================================================================

# Application name and version
APP_NAME=Knowledge Mapper
APP_VERSION=1.0.0

# API version prefix
API_V1_PREFIX=/api/v1

# Server binding
HOST=0.0.0.0
PORT=8000

# =============================================================================
# CORS CONFIGURATION
# =============================================================================

# CORS allowed origins (comma-separated)
# In production, specify exact origins - never use '*'
CORS_ORIGINS=https://app.example.com,https://www.example.com

# Allow credentials (required for cookie-based auth)
CORS_ALLOW_CREDENTIALS=true

# =============================================================================
# RATE LIMITING
# =============================================================================

# Enable rate limiting (recommended for production)
RATE_LIMIT_ENABLED=true

# Requests per minute per client (stricter for production)
RATE_LIMIT_REQUESTS_PER_MINUTE=60

# Failed authentication attempts per minute (prevents brute force)
RATE_LIMIT_FAILED_AUTH_PER_MINUTE=5

# Rate limit window in seconds
RATE_LIMIT_WINDOW_SECONDS=60

# =============================================================================
# SESSION CONFIGURATION
# =============================================================================

# Enable Secure cookie flag (HTTPS only)
SESSION_COOKIE_SECURE=true

# Session cookie max age in seconds (7 days)
SESSION_COOKIE_MAX_AGE=604800

# Frontend URL for post-authentication redirects
FRONTEND_URL=https://app.example.com

# =============================================================================
# MULTI-TENANCY
# =============================================================================

# JWT claim name containing tenant ID
TENANT_CLAIM_NAME=tenant_id

# Require tenant claim in all tokens
REQUIRE_TENANT_CLAIM=true

# Tenant cache TTL in seconds
TENANT_CACHE_TTL=3600

# =============================================================================
# SECURITY HEADERS
# =============================================================================

# Enable security headers middleware
SECURITY_HEADERS_ENABLED=true

# Content Security Policy
CSP_ENABLED=true

# HSTS (Strict Transport Security)
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true

# Enable HSTS preload (requires careful consideration)
# Only enable after testing and submitting to hstspreload.org
HSTS_PRELOAD=false

# Frame options (DENY prevents clickjacking)
X_FRAME_OPTIONS=DENY

# =============================================================================
# FRONTEND BUILD-TIME VARIABLES
# =============================================================================
# These are embedded during frontend build, not at runtime.
# Changes require rebuilding and redeploying the frontend.

VITE_API_URL=https://api.example.com
VITE_API_PREFIX=/api/v1
VITE_OIDC_AUTHORITY=https://auth.example.com/realms/knowledge-mapper-dev
VITE_OIDC_CLIENT_ID=knowledge-mapper-frontend

# =============================================================================
# OBSERVABILITY (OPTIONAL)
# =============================================================================

# OpenTelemetry service name
OTEL_SERVICE_NAME=backend

# OTLP collector endpoint (Tempo, Jaeger, etc.)
OTEL_EXPORTER_OTLP_ENDPOINT=http://tempo:4317

# Trace sampling rate (0.0 to 1.0)
# 0.1 = 10% of requests traced (recommended for production)
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1
