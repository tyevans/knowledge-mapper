# Knowledge Mapper - Staging Environment Configuration
#
# Copy this file to .env.staging and fill in actual values.
# NEVER commit .env.staging to version control.
#
# Staging mirrors production configuration with relaxed limits for testing.

# =============================================================================
# ENVIRONMENT
# =============================================================================

# Environment identifier
ENV=staging

# Disable debug mode (matches production)
DEBUG=false

# More verbose logging for debugging
LOG_LEVEL=debug

# Disable hot reload
RELOAD=false

# =============================================================================
# DATABASE (REQUIRED - SECRETS)
# =============================================================================

# PostgreSQL connection string for application runtime
DATABASE_URL=postgresql+asyncpg://knowledge_mapper_app_user:CHANGE_ME@staging-db:5432/knowledge_mapper_db

# PostgreSQL connection string for migrations
MIGRATION_DATABASE_URL=postgresql+asyncpg://knowledge_mapper_migration_user:CHANGE_ME@staging-db:5432/knowledge_mapper_db

# =============================================================================
# REDIS (REQUIRED - SECRETS)
# =============================================================================

# Redis connection string
REDIS_URL=redis://default:CHANGE_ME@staging-redis:6379/0

# =============================================================================
# OAUTH / AUTHENTICATION (REQUIRED)
# =============================================================================

# Staging Keycloak instance
OAUTH_ISSUER_URL=https://auth-staging.example.com/realms/knowledge-mapper-dev

# OAuth client ID
OAUTH_CLIENT_ID=knowledge-mapper-backend

# OAuth audience
OAUTH_AUDIENCE=knowledge-mapper-backend

# =============================================================================
# API CONFIGURATION
# =============================================================================

APP_NAME=Knowledge Mapper
APP_VERSION=1.0.0-staging

API_V1_PREFIX=/api/v1

HOST=0.0.0.0
PORT=8000

# =============================================================================
# CORS CONFIGURATION
# =============================================================================

# Staging domains
CORS_ORIGINS=https://staging.example.com,https://app-staging.example.com

CORS_ALLOW_CREDENTIALS=true

# =============================================================================
# RATE LIMITING (Relaxed for testing)
# =============================================================================

RATE_LIMIT_ENABLED=true

# Higher limits for load testing
RATE_LIMIT_REQUESTS_PER_MINUTE=200

# Relaxed for testing auth flows
RATE_LIMIT_FAILED_AUTH_PER_MINUTE=20

RATE_LIMIT_WINDOW_SECONDS=60

# =============================================================================
# SESSION CONFIGURATION
# =============================================================================

# Enable Secure cookies (staging uses HTTPS)
SESSION_COOKIE_SECURE=true

# Shorter session for testing
SESSION_COOKIE_MAX_AGE=86400

FRONTEND_URL=https://staging.example.com

# =============================================================================
# MULTI-TENANCY
# =============================================================================

TENANT_CLAIM_NAME=tenant_id
REQUIRE_TENANT_CLAIM=true
TENANT_CACHE_TTL=300

# =============================================================================
# SECURITY HEADERS
# =============================================================================

SECURITY_HEADERS_ENABLED=true
CSP_ENABLED=true
HSTS_ENABLED=true
HSTS_MAX_AGE=86400
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=false
X_FRAME_OPTIONS=DENY

# =============================================================================
# FRONTEND BUILD-TIME VARIABLES
# =============================================================================

VITE_API_URL=https://api-staging.example.com
VITE_API_PREFIX=/api/v1
VITE_OIDC_AUTHORITY=https://auth-staging.example.com/realms/knowledge-mapper-dev
VITE_OIDC_CLIENT_ID=knowledge-mapper-frontend

# =============================================================================
# OBSERVABILITY (OPTIONAL)
# =============================================================================

OTEL_SERVICE_NAME=backend
OTEL_EXPORTER_OTLP_ENDPOINT=http://tempo:4317

# Higher sampling for staging visibility
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.5
