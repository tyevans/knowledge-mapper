# Knowledge Mapper - Environment Variables Template
# Copy this file to .env and update the values as needed

# =============================================================================
# General
# =============================================================================
ENV=development
DEBUG=true
LOG_LEVEL=info
NODE_ENV=development

# =============================================================================
# Database (PostgreSQL 18)
# =============================================================================
POSTGRES_HOST=postgres
POSTGRES_PORT=5435
POSTGRES_DB=knowledge_mapper_db
POSTGRES_USER=knowledge_mapper_user
POSTGRES_PASSWORD=change_me_in_production

# =============================================================================
# Redis Cache
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=knowledge_mapper_redis_pass

# =============================================================================
# Backend API
# =============================================================================
BACKEND_PORT=8000
API_V1_PREFIX=/api/v1
# CORS_ORIGINS is configured in backend/app/core/config.py with good defaults
# Uncomment and customize if you need different origins:
# CORS_ORIGINS=http://localhost:5173,http://localhost:3001

# Database URL (constructed from POSTGRES_* variables)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}

# Redis URL (constructed from REDIS_* variables)
REDIS_URL=redis://default:${REDIS_PASSWORD}@redis:6379/0

# =============================================================================
# Frontend
# =============================================================================
FRONTEND_PORT=5173

# Backend API URL (accessible from browser - use host machine URL)
VITE_API_URL=http://localhost:8000

# =============================================================================
# Keycloak OAuth Provider
# =============================================================================
# WARNING: These credentials are for DEVELOPMENT ONLY
# Use strong passwords and proper secret management in production
KEYCLOAK_PORT=8080
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# =============================================================================
# OpenTelemetry (Observability)
# =============================================================================
# Service name for traces (identifies service in Tempo/Grafana)
OTEL_SERVICE_NAME=backend

# OTLP endpoint for trace export (Tempo gRPC endpoint)
OTEL_EXPORTER_OTLP_ENDPOINT=http://tempo:4317

# =============================================================================
# Database Backup Configuration
# =============================================================================
# Local backup directory (relative to project root)
BACKUP_DIR=./backups

# Retention policy (number of backups to keep)
# Daily: 7 days, Weekly: 4 weeks, Monthly: 12 months
BACKUP_RETENTION_DAILY=7
BACKUP_RETENTION_WEEKLY=4
BACKUP_RETENTION_MONTHLY=12

# S3 remote storage (optional - for offsite backups)
# Supports AWS S3, MinIO, Backblaze B2, Wasabi, etc.
# BACKUP_S3_BUCKET=
# BACKUP_S3_PREFIX=backups/
# BACKUP_S3_ENDPOINT=  # For S3-compatible services (MinIO, etc.)

# =============================================================================
# Database Restore Configuration
# =============================================================================
# Skip confirmation prompts for automated restores (use with caution!)
# RESTORE_SKIP_CONFIRM=false

# Create a backup before restoring (safety measure)
RESTORE_PRE_BACKUP=true

# =============================================================================
# Event Sourcing (eventsource-py)
# =============================================================================
# Master toggles for event sourcing features
EVENT_STORE_ENABLED=true
EVENT_STORE_OUTBOX_ENABLED=true

# Snapshot configuration
SNAPSHOT_ENABLED=true
SNAPSHOT_THRESHOLD=100

# =============================================================================
# Apache Kafka (Event Bus)
# =============================================================================
# Enable/disable Kafka integration
KAFKA_ENABLED=true

# Kafka broker addresses (comma-separated for cluster)
KAFKA_BOOTSTRAP_SERVERS=kafka:9092

# Topic prefix for all event topics
# Events are published to: {prefix}.tenant-{tenant_id}.{aggregate_type}
KAFKA_TOPIC_PREFIX=events

# Consumer group ID
KAFKA_CONSUMER_GROUP=knowledge-mapper

# Producer settings
KAFKA_ACKS=all
KAFKA_COMPRESSION_TYPE=gzip
KAFKA_BATCH_SIZE=16384
KAFKA_LINGER_MS=10

# Consumer settings
KAFKA_AUTO_OFFSET_RESET=earliest
KAFKA_SESSION_TIMEOUT_MS=30000
KAFKA_HEARTBEAT_INTERVAL_MS=10000

# Kafka UI port
KAFKA_UI_PORT=8081

# =============================================================================
# Neo4j (Knowledge Graph)
# =============================================================================
# Graph database for storing extracted entities and relationships
NEO4J_HTTP_PORT=7474
NEO4J_BOLT_PORT=7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=knowledge_mapper_neo4j_pass

# =============================================================================
# Celery (Task Queue)
# =============================================================================
# Distributed task queue for web scraping and entity extraction
# Uses Redis databases 1 and 2 (separate from cache on 0)
CELERY_BROKER_URL=redis://default:${REDIS_PASSWORD}@redis:6379/1
CELERY_RESULT_BACKEND=redis://default:${REDIS_PASSWORD}@redis:6379/2

# Worker settings
CELERY_WORKER_CONCURRENCY=4
CELERY_TASK_SOFT_TIME_LIMIT=3600
CELERY_TASK_TIME_LIMIT=3900

# Flower monitoring UI
FLOWER_PORT=5555
FLOWER_USER=admin
FLOWER_PASSWORD=admin

# =============================================================================
# LLM Configuration (Anthropic Claude)
# =============================================================================
# API key for Claude - required for semantic entity extraction
# Get your key from: https://console.anthropic.com/
ANTHROPIC_API_KEY=

# Model selection
LLM_MODEL=claude-sonnet-4-20250514
LLM_MAX_TOKENS=4096

# Rate limiting (per tenant)
LLM_RATE_LIMIT_RPM=50

# Cost controls (USD per tenant per day)
LLM_DAILY_COST_LIMIT=10.00

# Enable spaCy fallback when LLM unavailable
LLM_FALLBACK_ENABLED=true

# =============================================================================
# Ollama Configuration (Local LLM)
# =============================================================================
# Local Ollama instance for entity extraction (alternative to Claude)
# OLLAMA_ENABLED=true
# OLLAMA_BASE_URL=http://192.168.1.14:11434
# OLLAMA_MODEL=gemma3:12b
# OLLAMA_TIMEOUT=60
# OLLAMA_MAX_RETRIES=3
# OLLAMA_RATE_LIMIT_RPM=30
# OLLAMA_MAX_CONTEXT_LENGTH=8000
# OLLAMA_TEMPERATURE=0.1

# =============================================================================
# Encryption Configuration (Sensitive Data Protection)
# =============================================================================
# Field-level encryption for API keys, secrets, and other sensitive config
# Uses Fernet (AES-128-CBC + HMAC-SHA256) with per-tenant key derivation
#
# CRITICAL: Generate a unique key for production!
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
ENCRYPTION_ENABLED=true
ENCRYPTION_MASTER_KEY=

# =============================================================================
# Web Scraping Configuration
# =============================================================================
# Default settings for Scrapy spiders (can be overridden per-job)
SCRAPE_DEFAULT_DEPTH=3
SCRAPE_DEFAULT_DELAY=1.0
SCRAPE_MAX_PAGES_PER_JOB=1000
SCRAPE_CONCURRENT_REQUESTS=8
SCRAPE_USER_AGENT=KnowledgeMapper/1.0
SCRAPE_RESPECT_ROBOTS=true

# =============================================================================
# Inference Testing Configuration
# =============================================================================
# Interactive LLM inference testing playground

# Enable/disable inference testing feature
INFERENCE_ENABLED=true

# Default timeout for inference requests (seconds)
INFERENCE_DEFAULT_TIMEOUT=60

# Maximum prompt length (characters)
INFERENCE_MAX_PROMPT_LENGTH=100000

# Rate limiting (requests per minute)
INFERENCE_RATE_LIMIT_RPM=30
INFERENCE_RATE_LIMIT_BURST=5

# Default inference parameters
INFERENCE_DEFAULT_TEMPERATURE=0.7
INFERENCE_DEFAULT_MAX_TOKENS=1024

# Streaming configuration
INFERENCE_STREAMING_ENABLED=true

# History retention (days)
INFERENCE_HISTORY_RETENTION_DAYS=90

# Provider defaults
INFERENCE_OLLAMA_DEFAULT_URL=http://192.168.1.14:11434
INFERENCE_OLLAMA_DEFAULT_MODEL=gemma3:12b

# =============================================================================
# Docker Compose Service Ports
# =============================================================================
# These ports map container ports to host ports
# Format: HOST_PORT:CONTAINER_PORT
#
# PostgreSQL: 5435:5432 (uses 5435 to avoid conflicts with local PostgreSQL)
# Backend:    8000:8000
# Frontend:   5173:5173 (Vite dev server)
# Redis:      6379:6379
# Keycloak:   8080:8080 (OAuth/OIDC provider)
# Kafka:      9092:9092 (Event streaming)
# Kafka UI:   8081:8080 (Kafka management interface)
